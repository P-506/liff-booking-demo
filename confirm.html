<script>
document.addEventListener("DOMContentLoaded", function () {

  const API_URL = "https://script.google.com/macros/s/AKfycbw9Jg-z0bB6QMjdxXufLQx66CLuybPgcdPQWTs845MdfNnuA_4baUBsn214oCxywEA/exec";

  // à¸ªà¸£à¹‰à¸²à¸‡ iframe à¸¥à¹ˆà¸­à¸‡à¸«à¸™
  const iframe = document.createElement("iframe");
  iframe.name = "hidden_iframe";
  iframe.style.display = "none";
  document.body.appendChild(iframe);

  const confirmBtn = document.getElementById("confirmBtn");
  if (!confirmBtn) {
    console.error("à¹„à¸¡à¹ˆà¸žà¸šà¸›à¸¸à¹ˆà¸¡ confirmBtn");
    return;
  }

  confirmBtn.addEventListener("click", function () {

    const form = document.createElement("form");
    form.method = "POST";
    form.action = API_URL;
    form.target = "hidden_iframe";

    function addField(name, value) {
      const input = document.createElement("input");
      input.type = "hidden";
      input.name = name;
      input.value = value || "";
      form.appendChild(input);
    }

    addField("service_type", localStorage.getItem("service_type"));
    addField("area", localStorage.getItem("area"));
    addField("date", localStorage.getItem("date"));
    addField("slot", localStorage.getItem("slot"));

    document.body.appendChild(form);
    form.submit();

    alert("ðŸŽ‰ à¸ˆà¸­à¸‡à¸ªà¸³à¹€à¸£à¹‡à¸ˆ");
    localStorage.clear();

    if (window.liff && liff.isInClient()) {
      liff.closeWindow();
    }
  });

});
</script>
